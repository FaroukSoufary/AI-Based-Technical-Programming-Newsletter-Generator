use database pfe2024;
use schema stackoverflow;
use warehouse compute_wh;

-- Temp tables

create or replace TABLE TEMP_QUESTIONS (
	TAG_LIST VARCHAR(5000),
	ACCEPTED_ANSWER_ID NUMBER(38,0),
	ANSWER_COUNT NUMBER(38,0),
	SCORE NUMBER(38,0),
	CREATION_DATE NUMBER(38,0),
	QUESTION_ID NUMBER(38,0),
	TITLE VARCHAR(500),
	BODY VARCHAR(100000)
);

create or replace TABLETEMP_ANSWERS (
	ANSWER_ID NUMBER(38,0),
	QUESTION_ID NUMBER(38,0),
	BODY VARCHAR(100000)
);

-- The staging table

create or replace TRANSIENT TABLE STG_QUESTION_ANSWER (
	TAG_LIST VARCHAR(5000),
	QUESTION_ID NUMBER(38,0),
	ANSWER_COUNT NUMBER(38,0),
	SCORE NUMBER(38,0),
	CREATION_DATE NUMBER(38,0),
	TITLE VARCHAR(500),
	QUESTION_BODY VARCHAR(100000),
	ANSWER_ID NUMBER(38,0),
	ANSWER_BODY VARCHAR(100000)
);

-- The final table

create or replace TABLE QUESTION_ANSWER (
	TAG_LIST VARCHAR(5000),
	QUESTION_ID NUMBER(38,0),
	ANSWER_COUNT NUMBER(38,0),
	SCORE NUMBER(38,0),
	CREATION_DATE NUMBER(38,0),
	TITLE VARCHAR(5000),
	QUESTION_BODY VARCHAR(1000000),
	ANSWER_ID NUMBER(38,0),
	ANSWER_BODY VARCHAR(1000000),
	QUESTION_ANSWER_EMBEDDING VECTOR(FLOAT, 768)
);


-- The newsletters table

create or replace TABLE NEWSLETTERS (
	QUERY VARCHAR(16777216),
	MODEL VARCHAR(16777216),
	CREATION_DATE TIMESTAMP_LTZ(9),
	NEWSLETTER_BODY VARCHAR(16777216)
);

-- The stackoverflow weekly data table 

create or replace TABLE STACKOVERFLOW_WEEKLY (
	TAGS VARCHAR(16777216),
	TITLE VARCHAR(16777216),
	QUESTION_BODY VARCHAR(16777216),
	ANSWER_BODY VARCHAR(16777216),
	QUESTION_ID NUMBER(38,0),
	QUESTION_CREATION_DATE NUMBER(38,0),
	QUESTION_SCORE NUMBER(38,0),
	FAVORITE_COUNT NUMBER(38,0),
	QUESTION_UPVOTE_COUNT NUMBER(38,0),
	VIEW_COUNT NUMBER(38,0),
	ANSWER_UPVOTE_COUNT NUMBER(38,0),
	ANSWER_SCORE NUMBER(38,0),
	ANSWER_ID NUMBER(38,0),
	ANSWER_CREATION_DATE NUMBER(38,0)
);
